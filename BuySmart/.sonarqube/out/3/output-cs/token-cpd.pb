¨9
/D:\BuySmart\BuySmart\Identity\UsersDbContext.cs
	namespace 	
Identity
 
{ 
public 

class 
UsersDbContext 
:  !
	DbContext" +
{ 
public 
UsersDbContext 
( 
DbContextOptions .
<. /
UsersDbContext/ =
>= >
options? F
)F G
:H I
baseJ N
(N O
optionsO V
)V W
{		 	
}

 	
public 
DbSet 
< 
User 
> 
Users  
{! "
get# &
;& '
set( +
;+ ,
}- .
public 
DbSet 
< 
ConfirmationCode %
>% &
ConfirmationCodes' 8
{9 :
get; >
;> ?
set@ C
;C D
}E F
	protected 
override 
void 
OnModelCreating  /
(/ 0
ModelBuilder0 <
modelBuilder= I
)I J
{ 	
modelBuilder 
. 
Entity 
<  
User  $
>$ %
(% &
entity& ,
=>- /
{ 
entity 
. 
ToTable 
( 
$str &
)& '
;' (
entity 
. 
HasKey 
( 
e 
=>  "
e# $
.$ %
UserId% +
)+ ,
;, -
entity 
. 
Property 
(  
e  !
=>" $
e% &
.& '
UserId' -
)- .
. 
HasColumnType "
(" #
$str# )
)) *
;* +
entity 
. 
Property 
(  
e  !
=>" $
e% &
.& '
Email' ,
), -
. 

IsRequired 
(  
)  !
. 
HasMaxLength !
(! "
$num" %
)% &
;& '
entity 
. 
Property 
(  
e  !
=>" $
e% &
.& '
Password' /
)/ 0
. 

IsRequired 
(  
)  !
. 
HasMaxLength !
(! "
$num" %
)% &
;& '
entity 
. 
Property 
(  
e  !
=>" $
e% &
.& '
Name' +
)+ ,
. 

IsRequired 
(  
false  %
)% &
. 
HasMaxLength !
(! "
$num" %
)% &
;& '
entity   
.   
Property   
(    
e    !
=>  " $
e  % &
.  & '
Image  ' ,
)  , -
.!! 

IsRequired!! 
(!!  
false!!  %
)!!% &
."" 
HasMaxLength"" !
(""! "
$num""" %
)""% &
;""& '
entity## 
.## 
Property## 
(##  
e##  !
=>##" $
e##% &
.##& '
UserType##' /
)##/ 0
.$$ 
HasDefaultValue$$ $
($$$ %
UserType$$% -
.$$- .
Client$$. 4
)$$4 5
;$$5 6
}%% 
)%% 
;%% 
modelBuilder'' 
.'' 
Entity'' 
<''  
User''  $
>''$ %
(''% &
)''& '
.(( 
HasIndex(( 
((( 
u(( 
=>(( 
u((  
.((  !
Email((! &
)((& '
.)) 
IsUnique)) 
()) 
))) 
;)) 
modelBuilder++ 
.++ 
Entity++ 
<++  
ConfirmationCode++  0
>++0 1
(++1 2
entity++2 8
=>++9 ;
{,, 
entity-- 
.-- 
ToTable-- 
(-- 
$str-- 2
)--2 3
;--3 4
entity.. 
... 
HasKey.. 
(.. 
e.. 
=>..  "
e..# $
...$ %
CodeId..% +
)..+ ,
;.., -
entity// 
.// 
Property// 
(//  
e//  !
=>//" $
e//% &
.//& '
CodeId//' -
)//- .
.00 
HasColumnType00 "
(00" #
$str00# )
)00) *
.11 
ValueGeneratedOnAdd11 (
(11( )
)11) *
;11* +
entity22 
.22 
Property22 
(22  
e22  !
=>22" $
e22% &
.22& '
Code22' +
)22+ ,
.33 

IsRequired33 
(33  
)33  !
;33! "
entity44 
.44 
Property44 
(44  
e44  !
=>44" $
e44% &
.44& '
CreationTime44' 3
)443 4
.55 

IsRequired55 
(55  
)55  !
.66 
HasDefaultValueSql66 '
(66' (
$str66( ;
)66; <
;66< =
entity77 
.77 
Property77 
(77  
e77  !
=>77" $
e77% &
.77& '
Name77' +
)77+ ,
.88 

IsRequired88 
(88  
)88  !
.99 
HasMaxLength99 !
(99! "
$num99" %
)99% &
;99& '
entity:: 
.:: 
Property:: 
(::  
e::  !
=>::" $
e::% &
.::& '
Email::' ,
)::, -
.;; 

IsRequired;; 
(;;  
);;  !
.<< 
HasMaxLength<< !
(<<! "
$num<<" %
)<<% &
;<<& '
entity== 
.== 
HasIndex== 
(==  
e==  !
=>==" $
e==% &
.==& '
Email==' ,
)==, -
.>> 
IsUnique>> 
(>> 
)>> 
;>>  
entity?? 
.?? 
Property?? 
(??  
e??  !
=>??" $
e??% &
.??& '
Password??' /
)??/ 0
.@@ 

IsRequired@@ 
(@@  
)@@  !
.AA 
HasMaxLengthAA !
(AA! "
$numAA" %
)AA% &
;AA& '
entityBB 
.BB 
PropertyBB 
(BB  
eBB  !
=>BB" $
eBB% &
.BB& '
UserTypeBB' /
)BB/ 0
.CC 

IsRequiredCC 
(CC  
)CC  !
;CC! "
entityDD 
.DD 
PropertyDD 
(DD  
eDD  !
=>DD" $
eDD% &
.DD& '
ImageDD' ,
)DD, -
.EE 

IsRequiredEE 
(EE  
falseEE  %
)EE% &
;EE& '
}FF 
)FF 
;FF 
}GG 	
}HH 
}II »≠
@D:\BuySmart\BuySmart\Identity\Repositories\UserAuthRepository.cs
	namespace 	
Identity
 
. 
Repositories 
{ 
public 

class 
UserAuthRepository #
:$ %
IUserAuthRepository& 9
<9 :
User: >
>> ?
{ 
private 
readonly 
UsersDbContext '
usersDbContext( 6
;6 7
private 
readonly 
IConfiguration '
configuration( 5
;5 6
private 
readonly  
ApplicationDbContext -
context. 5
;5 6
public 
UserAuthRepository !
(! "
UsersDbContext" 0
usersDbContext1 ?
,? @
IConfigurationA O
configurationP ]
,] ^ 
ApplicationDbContext_ s
contextt {
){ |
{ 	
this 
. 
usersDbContext 
=  !
usersDbContext" 0
;0 1
this 
. 
configuration 
=  
configuration! .
;. /
this 
. 
context 
= 
context "
;" #
} 	
public 
async 
Task 
< 
Result  
<  !
string! '
>' (
>( )
VerifyPassword* 8
(8 9
Guid9 =
userId> D
,D E
stringF L
passwordM U
)U V
{ 	
try   
{!! 
var"" 
existingUser""  
=""! "
await""# (
usersDbContext"") 7
.""7 8
Users""8 =
.""= > 
SingleOrDefaultAsync""> R
(""R S
u""S T
=>""U W
u""X Y
.""Y Z
UserId""Z `
==""a c
userId""d j
)""j k
;""k l
if## 
(## 
existingUser##  
==##! #
null##$ (
||##) +
!##, -
BCrypt##- 3
.##3 4
Net##4 7
.##7 8
BCrypt##8 >
.##> ?
Verify##? E
(##E F
password##F N
,##N O
existingUser##P \
.##\ ]
Password##] e
)##e f
)##f g
{$$ 
return%% 
Result%% !
<%%! "
string%%" (
>%%( )
.%%) *
Failure%%* 1
(%%1 2
$str%%2 D
)%%D E
;%%E F
}&& 
return'' 
Result'' 
<'' 
string'' $
>''$ %
.''% &
Success''& -
(''- .
$str''. C
)''C D
;''D E
}(( 
catch)) 
()) 
	Exception)) 
ex)) 
)))  
{** 
return++ 
Result++ 
<++ 
string++ $
>++$ %
.++% &
Failure++& -
(++- .
ex++. 0
.++0 1
Message++1 8
)++8 9
;++9 :
},, 
}-- 	
public// 
async// 
Task// 
<// 
Result//  
<//  !
string//! '
>//' (
>//( )
Login//* /
(/// 0
User//0 4
user//5 9
)//9 :
{00 	
try11 
{22 
var33 
existingUser33  
=33! "
await33# (
usersDbContext33) 7
.337 8
Users338 =
.33= > 
SingleOrDefaultAsync33> R
(33R S
u33S T
=>33U W
u33X Y
.33Y Z
Email33Z _
==33` b
user33c g
.33g h
Email33h m
)33m n
;33n o
if44 
(44 
existingUser44  
==44! #
null44$ (
||44) +
!44, -
BCrypt44- 3
.443 4
Net444 7
.447 8
BCrypt448 >
.44> ?
Verify44? E
(44E F
user44F J
.44J K
Password44K S
,44S T
existingUser44U a
.44a b
Password44b j
)44j k
)44k l
{55 
return66 
Result66 !
<66! "
string66" (
>66( )
.66) *
Failure66* 1
(661 2
$str662 G
)66G H
;66H I
}77 
var99 
tokenHandler99  
=99! "
new99# &#
JwtSecurityTokenHandler99' >
(99> ?
)99? @
;99@ A
var:: 
key:: 
=:: 
Encoding:: "
.::" #
ASCII::# (
.::( )
GetBytes::) 1
(::1 2
configuration::2 ?
[::? @
$str::@ I
]::I J
!::J K
)::K L
;::L M
var;; 
tokenDescriptor;; #
=;;$ %
new;;& )#
SecurityTokenDescriptor;;* A
{<< 
Subject== 
=== 
new== !
ClaimsIdentity==" 0
(==0 1
new==1 4
List==5 9
<==9 :
Claim==: ?
>==? @
{>> 
new?? 
Claim?? !
(??! "

ClaimTypes??" ,
.??, -
Name??- 1
,??1 2
existingUser??3 ?
.??? @
UserId??@ F
.??F G
ToString??G O
(??O P
)??P Q
)??Q R
,??R S
new@@ 
Claim@@ !
(@@! "

ClaimTypes@@" ,
.@@, -
Role@@- 1
,@@1 2
existingUser@@3 ?
.@@? @
UserType@@@ H
.@@H I
ToString@@I Q
(@@Q R
)@@R S
)@@S T
}AA 
)AA 
,AA 
ExpiresBB 
=BB 
DateTimeBB &
.BB& '
UtcNowBB' -
.BB- .
AddDaysBB. 5
(BB5 6
$numBB6 7
)BB7 8
,BB8 9
SigningCredentialsCC &
=CC' (
newCC) ,
SigningCredentialsCC- ?
(CC? @
newCC@ C 
SymmetricSecurityKeyCCD X
(CCX Y
keyCCY \
)CC\ ]
,CC] ^
SecurityAlgorithmsCC_ q
.CCq r 
HmacSha256Signature	CCr Ö
)
CCÖ Ü
}DD 
;DD 
varFF 
tokenFF 
=FF 
tokenHandlerFF (
.FF( )
CreateTokenFF) 4
(FF4 5
tokenDescriptorFF5 D
)FFD E
;FFE F
returnGG 
ResultGG 
<GG 
stringGG $
>GG$ %
.GG% &
SuccessGG& -
(GG- .
tokenHandlerGG. :
.GG: ;

WriteTokenGG; E
(GGE F
tokenGGF K
)GGK L
)GGL M
;GGM N
}HH 
catchII 
(II 
	ExceptionII 
exII 
)II  
{JJ 
returnKK 
ResultKK 
<KK 
stringKK $
>KK$ %
.KK% &
FailureKK& -
(KK- .
exKK. 0
.KK0 1
MessageKK1 8
)KK8 9
;KK9 :
}LL 
}MM 	
publicOO 
asyncOO 
TaskOO 
<OO 
ResultOO  
<OO  !
stringOO! '
>OO' (
>OO( ) 
SendVerificationCodeOO* >
(OO> ?
UserOO? C
userOOD H
,OOH I
CancellationTokenOOJ [
cancellationTokenOO\ m
)OOm n
{PP 	
tryQQ 
{RR 
varSS 
verificationCodeSS $
=SS% &
newSS' *
RandomSS+ 1
(SS1 2
)SS2 3
.SS3 4
NextSS4 8
(SS8 9
$numSS9 ?
,SS? @
$numSSA G
)SSG H
;SSH I
varTT 
imageFromStringTT #
=TT$ %
ConvertTT& -
.TT- .
FromBase64StringTT. >
(TT> ?
userTT? C
.TTC D
ImageTTD I
)TTI J
;TTJ K
varUU 
existingUserUU  
=UU! "
awaitUU# (
contextUU) 0
.UU0 1
UsersUU1 6
.UU6 7 
SingleOrDefaultAsyncUU7 K
(UUK L
uUUL M
=>UUN P
uUUQ R
.UUR S
EmailUUS X
==UUY [
userUU\ `
.UU` a
EmailUUa f
,UUf g
cancellationTokenUUh y
)UUy z
;UUz {
ifVV 
(VV 
existingUserVV  
!=VV! #
nullVV$ (
)VV( )
{WW 
returnXX 
ResultXX !
<XX! "
stringXX" (
>XX( )
.XX) *
FailureXX* 1
(XX1 2
$strXX2 H
)XXH I
;XXI J
}YY 
ConfirmationCodeZZ  
confirmationCodeZZ! 1
=ZZ2 3
newZZ4 7
ConfirmationCodeZZ8 H
{[[ 
Code\\ 
=\\ 
verificationCode\\ +
,\\+ ,
Email]] 
=]] 
user]]  
.]]  !
Email]]! &
,]]& '
Name^^ 
=^^ 
user^^ 
.^^  
Name^^  $
,^^$ %
Password__ 
=__ 
user__ #
.__# $
Password__$ ,
,__, -
UserType`` 
=`` 
user`` #
.``# $
UserType``$ ,
,``, -
Imageaa 
=aa 
imageFromStringaa +
}bb 
;bb 
varcc 
sendGridClientcc "
=cc# $
newcc% (
SendGridClientcc) 7
(cc7 8
configurationcc8 E
[ccE F
$strccF W
]ccW X
)ccX Y
;ccY Z
vardd 
fromdd 
=dd 
newdd 
EmailAddressdd +
(dd+ ,
configurationdd, 9
[dd9 :
$strdd: N
]ddN O
,ddO P
configurationddQ ^
[dd^ _
$strdd_ r
]ddr s
)dds t
;ddt u
varee 
toee 
=ee 
newee 
EmailAddressee )
(ee) *
useree* .
.ee. /
Emailee/ 4
,ee4 5
useree6 :
.ee: ;
Nameee; ?
)ee? @
;ee@ A
varff 
dynamicTemplateDataff '
=ff( )
newff* -

Dictionaryff. 8
<ff8 9
stringff9 ?
,ff? @
stringffA G
>ffG H
{gg 
{hh 
$strhh  
,hh  !
userhh" &
.hh& '
Namehh' +
}hh, -
,hh- .
{ii 
$strii 
,ii 
verificationCodeii .
.ii. /
ToStringii/ 7
(ii7 8
)ii8 9
}ii: ;
}jj 
;jj 
varkk 
msgkk 
=kk 

MailHelperkk $
.kk$ %%
CreateSingleTemplateEmailkk% >
(kk> ?
fromkk? C
,kkC D
tokkE G
,kkG H
configurationkkI V
[kkV W
$strkkW l
]kkl m
,kkm n 
dynamicTemplateData	kko Ç
)
kkÇ É
;
kkÉ Ñ
varll 
responsell 
=ll 
awaitll $
sendGridClientll% 3
.ll3 4
SendEmailAsyncll4 B
(llB C
msgllC F
,llF G
cancellationTokenllH Y
)llY Z
;llZ [
ifmm 
(mm 
responsemm 
.mm 

StatusCodemm '
!=mm( *
HttpStatusCodemm+ 9
.mm9 :
OKmm: <
&&mm= ?
responsemm@ H
.mmH I

StatusCodemmI S
!=mmT V
HttpStatusCodemmW e
.mme f
Acceptedmmf n
)mmn o
{nn 
returnoo 
Resultoo !
<oo! "
stringoo" (
>oo( )
.oo) *
Failureoo* 1
(oo1 2
$stroo2 H
)ooH I
;ooI J
}pp 
elseqq 
{rr 
varss $
existingConfirmationCodess 0
=ss1 2
awaitss3 8
usersDbContextss9 G
.ssG H
ConfirmationCodesssH Y
.ssY Z 
SingleOrDefaultAsyncssZ n
(ssn o
csso p
=>ssq s
csst u
.ssu v
Emailssv {
==ss| ~
user	ss É
.
ssÉ Ñ
Email
ssÑ â
,
ssâ ä
cancellationToken
ssã ú
)
ssú ù
;
ssù û
iftt 
(tt $
existingConfirmationCodett 0
!=tt1 3
nulltt4 8
)tt8 9
{uu 
usersDbContextvv &
.vv& '
ConfirmationCodesvv' 8
.vv8 9
Removevv9 ?
(vv? @$
existingConfirmationCodevv@ X
)vvX Y
;vvY Z
}ww 
usersDbContextxx "
.xx" #
ConfirmationCodesxx# 4
.xx4 5
Addxx5 8
(xx8 9
confirmationCodexx9 I
)xxI J
;xxJ K
awaityy 
usersDbContextyy (
.yy( )
SaveChangesAsyncyy) 9
(yy9 :
cancellationTokenyy: K
)yyK L
;yyL M
var{{  
oldConfirmationCodes{{ ,
={{- .
await{{/ 4
usersDbContext{{5 C
.{{C D
ConfirmationCodes{{D U
.{{U V
Where{{V [
({{[ \
c{{\ ]
=>{{^ `
c{{a b
.{{b c
CreationTime{{c o
.{{o p

AddMinutes{{p z
({{z {
$num{{{ }
){{} ~
<	{{ Ä
DateTime
{{Å â
.
{{â ä
UtcNow
{{ä ê
)
{{ê ë
.
{{ë í
ToListAsync
{{í ù
(
{{ù û
cancellationToken
{{û Ø
)
{{Ø ∞
;
{{∞ ±
if|| 
(||  
oldConfirmationCodes|| ,
!=||- /
null||0 4
)||4 5
{||6 7
usersDbContext}} &
.}}& '
ConfirmationCodes}}' 8
.}}8 9
RemoveRange}}9 D
(}}D E 
oldConfirmationCodes}}E Y
)}}Y Z
;}}Z [
await~~ 
usersDbContext~~ ,
.~~, -
SaveChangesAsync~~- =
(~~= >
cancellationToken~~> O
)~~O P
;~~P Q
} 
return
ÄÄ 
Result
ÄÄ !
<
ÄÄ! "
string
ÄÄ" (
>
ÄÄ( )
.
ÄÄ) *
Success
ÄÄ* 1
(
ÄÄ1 2
verificationCode
ÄÄ2 B
.
ÄÄB C
ToString
ÄÄC K
(
ÄÄK L
)
ÄÄL M
)
ÄÄM N
;
ÄÄN O
}
ÅÅ 
}
ÇÇ 
catch
ÉÉ 
(
ÉÉ 
	Exception
ÉÉ 
ex
ÉÉ 
)
ÉÉ  
{
ÑÑ 
return
ÖÖ 
Result
ÖÖ 
<
ÖÖ 
string
ÖÖ $
>
ÖÖ$ %
.
ÖÖ% &
Failure
ÖÖ& -
(
ÖÖ- .
ex
ÖÖ. 0
.
ÖÖ0 1
Message
ÖÖ1 8
)
ÖÖ8 9
;
ÖÖ9 :
}
ÜÜ 
}
áá 	
public
ââ 
async
ââ 
Task
ââ 
<
ââ 
Result
ââ  
<
ââ  !
Guid
ââ! %
>
ââ% &
>
ââ& '
Register
ââ( 0
(
ââ0 1
int
ââ1 4
verificationCode
ââ5 E
,
ââE F
CancellationToken
ââG X
cancellationToken
ââY j
)
ââj k
{
ää 	
try
ãã 
{
åå 
var
çç $
confirmationCodeEntity
çç *
=
çç+ ,
await
çç- 2
usersDbContext
çç3 A
.
ççA B
ConfirmationCodes
ççB S
.
ççS T"
SingleOrDefaultAsync
ççT h
(
ççh i
c
ççi j
=>
ççk m
c
ççn o
.
çço p
Code
ççp t
==
ççu w
verificationCodeççx à
,ççà â!
cancellationTokenççä õ
)ççõ ú
;ççú ù
if
éé 
(
éé $
confirmationCodeEntity
éé *
==
éé+ -
null
éé. 2
)
éé2 3
{
èè 
return
êê 
Result
êê !
<
êê! "
Guid
êê" &
>
êê& '
.
êê' (
Failure
êê( /
(
êê/ 0
$str
êê0 K
)
êêK L
;
êêL M
}
ëë 
if
íí 
(
íí $
confirmationCodeEntity
íí *
.
íí* +
CreationTime
íí+ 7
.
íí7 8

AddMinutes
íí8 B
(
ííB C
$num
ííC E
)
ííE F
<
ííG H
DateTime
ííI Q
.
ííQ R
UtcNow
ííR X
)
ííX Y
{
ìì 
usersDbContext
îî "
.
îî" #
ConfirmationCodes
îî# 4
.
îî4 5
Remove
îî5 ;
(
îî; <$
confirmationCodeEntity
îî< R
)
îîR S
;
îîS T
await
ïï 
usersDbContext
ïï (
.
ïï( )
SaveChangesAsync
ïï) 9
(
ïï9 :
cancellationToken
ïï: K
)
ïïK L
;
ïïL M
return
ññ 
Result
ññ !
<
ññ! "
Guid
ññ" &
>
ññ& '
.
ññ' (
Failure
ññ( /
(
ññ/ 0
$str
ññ0 K
)
ññK L
;
ññL M
}
óó 
string
ôô 
?
ôô 
relativePath
ôô $
=
ôô% &
configuration
ôô' 4
[
ôô4 5
$str
ôô5 H
]
ôôH I
;
ôôI J
if
öö 
(
öö 
string
öö 
.
öö 
IsNullOrEmpty
öö (
(
öö( )
relativePath
öö) 5
)
öö5 6
)
öö6 7
{
õõ 
return
úú 
Result
úú !
<
úú! "
Guid
úú" &
>
úú& '
.
úú' (
Failure
úú( /
(
úú/ 0
$str
úú0 [
)
úú[ \
;
úú\ ]
}
ùù 
var
üü 
projectRootDir
üü "
=
üü# $
	Directory
üü% .
.
üü. /
	GetParent
üü/ 8
(
üü8 9

AppContext
üü9 C
.
üüC D
BaseDirectory
üüD Q
)
üüQ R
?
üüR S
.
üüS T
Parent
üüT Z
?
üüZ [
.
üü[ \
Parent
üü\ b
?
üüb c
.
üüc d
Parent
üüd j
;
üüj k
if
†† 
(
†† 
projectRootDir
†† "
==
††# %
null
††& *
)
††* +
{
°° 
return
¢¢ 
Result
¢¢ !
<
¢¢! "
Guid
¢¢" &
>
¢¢& '
.
¢¢' (
Failure
¢¢( /
(
¢¢/ 0
$str
¢¢0 a
)
¢¢a b
;
¢¢b c
}
££ 
string
•• 
fullPathToPhotos
•• '
=
••( )
Path
••* .
.
••. /
Combine
••/ 6
(
••6 7
projectRootDir
••7 E
.
••E F
FullName
••F N
,
••N O
relativePath
••P \
)
••\ ]
;
••] ^
if
ßß 
(
ßß 
!
ßß 
	Directory
ßß 
.
ßß 
Exists
ßß %
(
ßß% &
fullPathToPhotos
ßß& 6
)
ßß6 7
)
ßß7 8
{
®® 
return
©© 
Result
©© !
<
©©! "
Guid
©©" &
>
©©& '
.
©©' (
Failure
©©( /
(
©©/ 0
$"
©©0 2
$str
©©2 _
{
©©_ `
fullPathToPhotos
©©` p
}
©©p q
"
©©q r
)
©©r s
;
©©s t
}
™™ 
fullPathToPhotos
¨¨  
=
¨¨! "
Path
¨¨# '
.
¨¨' (
GetFullPath
¨¨( 3
(
¨¨3 4
fullPathToPhotos
¨¨4 D
)
¨¨D E
;
¨¨E F
string
≠≠ 
profilePhotoPath
≠≠ '
;
≠≠' (
if
ØØ 
(
ØØ $
confirmationCodeEntity
ØØ *
.
ØØ* +
Image
ØØ+ 0
!=
ØØ1 3
null
ØØ4 8
&&
ØØ9 ;$
confirmationCodeEntity
ØØ< R
.
ØØR S
Image
ØØS X
.
ØØX Y
Length
ØØY _
>
ØØ_ `
$num
ØØa b
)
ØØb c
{
∞∞ 
string
±± 
fileName
±± #
=
±±$ %
$"
±±& (
{
±±( )$
confirmationCodeEntity
±±) ?
.
±±? @
Name
±±@ D
}
±±D E
$str
±±E I
"
±±I J
;
±±J K
profilePhotoPath
≤≤ $
=
≤≤% &
Path
≤≤' +
.
≤≤+ ,
Combine
≤≤, 3
(
≤≤3 4
fullPathToPhotos
≤≤4 D
,
≤≤D E
fileName
≤≤F N
)
≤≤N O
;
≤≤O P
await
≥≥ 
File
≥≥ 
.
≥≥  
WriteAllBytesAsync
≥≥ 1
(
≥≥1 2
profilePhotoPath
≥≥2 B
,
≥≥B C$
confirmationCodeEntity
≥≥D Z
.
≥≥Z [
Image
≥≥[ `
,
≥≥` a
cancellationToken
≥≥b s
)
≥≥s t
;
≥≥t u
}
¥¥ 
else
µµ 
{
∂∂ 
string
∑∑ 
defaultPhotoPath
∑∑ +
=
∑∑, -
Path
∑∑. 2
.
∑∑2 3
Combine
∑∑3 :
(
∑∑: ;
fullPathToPhotos
∑∑; K
,
∑∑K L
$str
∑∑M Z
)
∑∑Z [
;
∑∑[ \
profilePhotoPath
∏∏ $
=
∏∏% &
Path
∏∏' +
.
∏∏+ ,
Combine
∏∏, 3
(
∏∏3 4
fullPathToPhotos
∏∏4 D
,
∏∏D E
$"
∏∏F H
{
∏∏H I$
confirmationCodeEntity
∏∏I _
.
∏∏_ `
Name
∏∏` d
}
∏∏d e
$str
∏∏e i
"
∏∏i j
)
∏∏j k
;
∏∏k l
File
ππ 
.
ππ 
Copy
ππ 
(
ππ 
defaultPhotoPath
ππ .
,
ππ. /
profilePhotoPath
ππ0 @
,
ππ@ A
	overwrite
ππB K
:
ππK L
true
ππM Q
)
ππQ R
;
ππR S
}
∫∫ 
var
ªª 
user
ªª 
=
ªª 
new
ªª 
User
ªª #
{
ºº 
Name
ΩΩ 
=
ΩΩ $
confirmationCodeEntity
ΩΩ 1
.
ΩΩ1 2
Name
ΩΩ2 6
,
ΩΩ6 7
Email
ææ 
=
ææ $
confirmationCodeEntity
ææ 2
.
ææ2 3
Email
ææ3 8
,
ææ8 9
Password
øø 
=
øø $
confirmationCodeEntity
øø 5
.
øø5 6
Password
øø6 >
,
øø> ?
UserType
¿¿ 
=
¿¿ $
confirmationCodeEntity
¿¿ 5
.
¿¿5 6
UserType
¿¿6 >
,
¿¿> ?
Image
¡¡ 
=
¡¡ 
profilePhotoPath
¡¡ ,
}
¬¬ 
;
¬¬ 
Guid
√√ 
userId
√√ 
;
√√ 
if
≈≈ 
(
≈≈ 
user
≈≈ 
.
≈≈ 
UserType
≈≈ !
==
≈≈" $
UserType
≈≈% -
.
≈≈- .
Client
≈≈. 4
)
≈≈4 5
{
∆∆ 
userId
«« 
=
«« 
await
«« " 
AddUserClientAsync
««# 5
(
««5 6
user
««6 :
,
««: ;
cancellationToken
««< M
)
««M N
;
««N O
}
»» 
else
…… 
if
…… 
(
…… 
user
…… 
.
…… 
UserType
…… &
==
……' )
UserType
……* 2
.
……2 3
Business
……3 ;
)
……; <
{
   
userId
ÀÀ 
=
ÀÀ 
await
ÀÀ ""
AddUserBusinessAsync
ÀÀ# 7
(
ÀÀ7 8
user
ÀÀ8 <
,
ÀÀ< =
cancellationToken
ÀÀ> O
)
ÀÀO P
;
ÀÀP Q
}
ÃÃ 
else
ÕÕ 
{
ŒŒ 
return
œœ 
Result
œœ !
<
œœ! "
Guid
œœ" &
>
œœ& '
.
œœ' (
Failure
œœ( /
(
œœ/ 0
$str
œœ0 D
)
œœD E
;
œœE F
}
–– 
user
—— 
.
—— 
UserId
—— 
=
—— 
userId
—— $
;
——$ %
usersDbContext
““ 
.
““ 
Users
““ $
.
““$ %
Add
““% (
(
““( )
user
““) -
)
““- .
;
““. /
await
”” 
usersDbContext
”” $
.
””$ %
SaveChangesAsync
””% 5
(
””5 6
cancellationToken
””6 G
)
””G H
;
””H I
usersDbContext
‘‘ 
.
‘‘ 
ConfirmationCodes
‘‘ 0
.
‘‘0 1
Remove
‘‘1 7
(
‘‘7 8$
confirmationCodeEntity
‘‘8 N
)
‘‘N O
;
‘‘O P
await
’’ 
usersDbContext
’’ $
.
’’$ %
SaveChangesAsync
’’% 5
(
’’5 6
cancellationToken
’’6 G
)
’’G H
;
’’H I
return
◊◊ 
Result
◊◊ 
<
◊◊ 
Guid
◊◊ "
>
◊◊" #
.
◊◊# $
Success
◊◊$ +
(
◊◊+ ,
userId
◊◊, 2
)
◊◊2 3
;
◊◊3 4
}
ÿÿ 
catch
ŸŸ 
(
ŸŸ 
	Exception
ŸŸ 
ex
ŸŸ 
)
ŸŸ  
{
⁄⁄ 
return
€€ 
Result
€€ 
<
€€ 
Guid
€€ "
>
€€" #
.
€€# $
Failure
€€$ +
(
€€+ ,
ex
€€, .
.
€€. /
Message
€€/ 6
)
€€6 7
;
€€7 8
}
‹‹ 
}
›› 	
private
ﬂﬂ 
async
ﬂﬂ 
Task
ﬂﬂ 
<
ﬂﬂ 
Guid
ﬂﬂ 
>
ﬂﬂ   
AddUserClientAsync
ﬂﬂ! 3
(
ﬂﬂ3 4
User
ﬂﬂ4 8
user
ﬂﬂ9 =
,
ﬂﬂ= >
CancellationToken
ﬂﬂ? P
cancellationToken
ﬂﬂQ b
)
ﬂﬂb c
{
‡‡ 	
var
·· 

userClient
·· 
=
·· 
new
··  

UserClient
··! +
{
‚‚ 
Name
„„ 
=
„„ 
user
„„ 
.
„„ 
Name
„„  
,
„„  !
Email
‰‰ 
=
‰‰ 
user
‰‰ 
.
‰‰ 
Email
‰‰ "
,
‰‰" #
Password
ÂÂ 
=
ÂÂ 
user
ÂÂ 
.
ÂÂ  
Password
ÂÂ  (
,
ÂÂ( )
UserType
ÊÊ 
=
ÊÊ 
UserType
ÊÊ #
.
ÊÊ# $
Client
ÊÊ$ *
,
ÊÊ* +
Image
ÁÁ 
=
ÁÁ 
user
ÁÁ 
.
ÁÁ 
Image
ÁÁ "
}
ËË 
;
ËË 
await
ÍÍ 
context
ÍÍ 
.
ÍÍ 
UserClients
ÍÍ %
.
ÍÍ% &
AddAsync
ÍÍ& .
(
ÍÍ. /

userClient
ÍÍ/ 9
,
ÍÍ9 :
cancellationToken
ÍÍ; L
)
ÍÍL M
;
ÍÍM N
await
ÎÎ 
context
ÎÎ 
.
ÎÎ 
SaveChangesAsync
ÎÎ *
(
ÎÎ* +
cancellationToken
ÎÎ+ <
)
ÎÎ< =
;
ÎÎ= >
return
ÏÏ 

userClient
ÏÏ 
.
ÏÏ 
UserId
ÏÏ $
;
ÏÏ$ %
}
ÌÌ 	
private
ÔÔ 
async
ÔÔ 
Task
ÔÔ 
<
ÔÔ 
Guid
ÔÔ 
>
ÔÔ  "
AddUserBusinessAsync
ÔÔ! 5
(
ÔÔ5 6
User
ÔÔ6 :
user
ÔÔ; ?
,
ÔÔ? @
CancellationToken
ÔÔA R
cancellationToken
ÔÔS d
)
ÔÔd e
{
 	
var
ÒÒ 
userBusiness
ÒÒ 
=
ÒÒ 
new
ÒÒ "
UserBusiness
ÒÒ# /
{
ÚÚ 
Name
ÛÛ 
=
ÛÛ 
user
ÛÛ 
.
ÛÛ 
Name
ÛÛ  
,
ÛÛ  !
Email
ÙÙ 
=
ÙÙ 
user
ÙÙ 
.
ÙÙ 
Email
ÙÙ "
,
ÙÙ" #
Password
ıı 
=
ıı 
user
ıı 
.
ıı  
Password
ıı  (
,
ıı( )
UserType
ˆˆ 
=
ˆˆ 
UserType
ˆˆ #
.
ˆˆ# $
Business
ˆˆ$ ,
,
ˆˆ, -
Image
˜˜ 
=
˜˜ 
user
˜˜ 
.
˜˜ 
Image
˜˜ "
}
¯¯ 
;
¯¯ 
await
˙˙ 
context
˙˙ 
.
˙˙ 
UserBusinesses
˙˙ (
.
˙˙( )
AddAsync
˙˙) 1
(
˙˙1 2
userBusiness
˙˙2 >
,
˙˙> ?
cancellationToken
˙˙@ Q
)
˙˙Q R
;
˙˙R S
await
˚˚ 
context
˚˚ 
.
˚˚ 
SaveChangesAsync
˚˚ *
(
˚˚* +
cancellationToken
˚˚+ <
)
˚˚< =
;
˚˚= >
return
¸¸ 
userBusiness
¸¸ 
.
¸¸  
UserId
¸¸  &
;
¸¸& '
}
˝˝ 	
public
ˇˇ 
async
ˇˇ 
Task
ˇˇ 
DeleteUserAsync
ˇˇ )
(
ˇˇ) *
Guid
ˇˇ* .
userId
ˇˇ/ 5
)
ˇˇ5 6
{
ÄÄ 	
User
ÅÅ 
?
ÅÅ 
user
ÅÅ 
=
ÅÅ 
await
ÅÅ 
usersDbContext
ÅÅ -
.
ÅÅ- .
Users
ÅÅ. 3
.
ÅÅ3 4
	FindAsync
ÅÅ4 =
(
ÅÅ= >
userId
ÅÅ> D
)
ÅÅD E
;
ÅÅE F
if
ÇÇ 
(
ÇÇ 
user
ÇÇ 
==
ÇÇ 
null
ÇÇ 
)
ÇÇ 
{
ÉÉ 
throw
ÑÑ 
new
ÑÑ "
KeyNotFoundException
ÑÑ .
(
ÑÑ. /
$str
ÑÑ/ ?
)
ÑÑ? @
;
ÑÑ@ A
}
ÖÖ 
usersDbContext
ÜÜ 
.
ÜÜ 
Users
ÜÜ  
.
ÜÜ  !
Remove
ÜÜ! '
(
ÜÜ' (
user
ÜÜ( ,
)
ÜÜ, -
;
ÜÜ- .
await
áá 
usersDbContext
áá  
.
áá  !
SaveChangesAsync
áá! 1
(
áá1 2
)
áá2 3
;
áá3 4
if
àà 
(
àà 
user
àà 
.
àà 
UserType
àà 
==
àà  
UserType
àà! )
.
àà) *
Client
àà* 0
)
àà0 1
{
ââ 
var
ää 

userClient
ää 
=
ää  
await
ää! &
context
ää' .
.
ää. /
UserClients
ää/ :
.
ää: ;
	FindAsync
ää; D
(
ääD E
userId
ääE K
)
ääK L
;
ääL M
if
ãã 
(
ãã 

userClient
ãã 
!=
ãã !
null
ãã" &
)
ãã& '
{
åå 
context
çç 
.
çç 
UserClients
çç '
.
çç' (
Remove
çç( .
(
çç. /

userClient
çç/ 9
)
çç9 :
;
çç: ;
await
éé 
context
éé !
.
éé! "
SaveChangesAsync
éé" 2
(
éé2 3
)
éé3 4
;
éé4 5
}
èè 
}
êê 
else
ëë 
if
ëë 
(
ëë 
user
ëë 
.
ëë 
UserType
ëë "
==
ëë# %
UserType
ëë& .
.
ëë. /
Business
ëë/ 7
)
ëë7 8
{
íí 
var
ìì 
userBusiness
ìì  
=
ìì! "
await
ìì# (
context
ìì) 0
.
ìì0 1
UserBusinesses
ìì1 ?
.
ìì? @
	FindAsync
ìì@ I
(
ììI J
userId
ììJ P
)
ììP Q
;
ììQ R
if
îî 
(
îî 
userBusiness
îî  
!=
îî! #
null
îî$ (
)
îî( )
{
ïï 
context
ññ 
.
ññ 
UserBusinesses
ññ *
.
ññ* +
Remove
ññ+ 1
(
ññ1 2
userBusiness
ññ2 >
)
ññ> ?
;
ññ? @
await
óó 
context
óó !
.
óó! "
SaveChangesAsync
óó" 2
(
óó2 3
)
óó3 4
;
óó4 5
}
òò 
}
ôô 
}
öö 	
public
úú 
async
úú 
Task
úú 
<
úú 
User
úú 
>
úú 
GetByIdAsync
úú  ,
(
úú, -
Guid
úú- 1
userId
úú2 8
)
úú8 9
{
ùù 	
var
ûû 
user
ûû 
=
ûû 
await
ûû 
usersDbContext
ûû +
.
ûû+ ,
Users
ûû, 1
.
ûû1 2
	FindAsync
ûû2 ;
(
ûû; <
userId
ûû< B
)
ûûB C
;
ûûC D
if
üü 
(
üü 
user
üü 
==
üü 
null
üü 
)
üü 
{
†† 
throw
°° 
new
°° "
KeyNotFoundException
°° .
(
°°. /
$str
°°/ ?
)
°°? @
;
°°@ A
}
¢¢ 
return
££ 
user
££ 
;
££ 
}
§§ 	
public
¶¶ 
async
¶¶ 
Task
¶¶ 
<
¶¶ 
Result
¶¶  
<
¶¶  !
object
¶¶! '
>
¶¶' (
>
¶¶( )
UpdateUserAsync
¶¶* 9
(
¶¶9 :
User
¶¶: >
user
¶¶? C
)
¶¶C D
{
ßß 	
try
®® 
{
©© 
var
™™ 
existingUser
™™  
=
™™! "
await
™™# (
usersDbContext
™™) 7
.
™™7 8
Users
™™8 =
.
™™= >
	FindAsync
™™> G
(
™™G H
user
™™H L
.
™™L M
UserId
™™M S
)
™™S T
;
™™T U
if
´´ 
(
´´ 
existingUser
´´  
==
´´! #
null
´´$ (
)
´´( )
{
¨¨ 
return
≠≠ 
Result
≠≠ !
<
≠≠! "
object
≠≠" (
>
≠≠( )
.
≠≠) *
Failure
≠≠* 1
(
≠≠1 2
$str
≠≠2 B
)
≠≠B C
;
≠≠C D
}
ÆÆ 
existingUser
∞∞ 
.
∞∞ 
Name
∞∞ !
=
∞∞" #
user
∞∞$ (
.
∞∞( )
Name
∞∞) -
;
∞∞- .
existingUser
±± 
.
±± 
Email
±± "
=
±±# $
user
±±% )
.
±±) *
Email
±±* /
;
±±/ 0
existingUser
≤≤ 
.
≤≤ 
Password
≤≤ %
=
≤≤& '
user
≤≤( ,
.
≤≤, -
Password
≤≤- 5
;
≤≤5 6
usersDbContext
¥¥ 
.
¥¥ 
Users
¥¥ $
.
¥¥$ %
Update
¥¥% +
(
¥¥+ ,
existingUser
¥¥, 8
)
¥¥8 9
;
¥¥9 :
await
µµ 
usersDbContext
µµ $
.
µµ$ %
SaveChangesAsync
µµ% 5
(
µµ5 6
)
µµ6 7
;
µµ7 8
if
∂∂ 
(
∂∂ 
user
∂∂ 
.
∂∂ 
UserType
∂∂ !
==
∂∂" $
UserType
∂∂% -
.
∂∂- .
Client
∂∂. 4
)
∂∂4 5
{
∑∑ 
var
∏∏  
existingUserClient
∏∏ *
=
∏∏+ ,
await
∏∏- 2
context
∏∏3 :
.
∏∏: ;
UserClients
∏∏; F
.
∏∏F G
	FindAsync
∏∏G P
(
∏∏P Q
user
∏∏Q U
.
∏∏U V
UserId
∏∏V \
)
∏∏\ ]
;
∏∏] ^
if
ππ 
(
ππ  
existingUserClient
ππ *
==
ππ+ -
null
ππ. 2
)
ππ2 3
{
∫∫ 
return
ªª 
Result
ªª %
<
ªª% &
object
ªª& ,
>
ªª, -
.
ªª- .
Failure
ªª. 5
(
ªª5 6
$str
ªª6 L
)
ªªL M
;
ªªM N
}
ºº  
existingUserClient
ææ &
.
ææ& '
Name
ææ' +
=
ææ, -
user
ææ. 2
.
ææ2 3
Name
ææ3 7
;
ææ7 8 
existingUserClient
øø &
.
øø& '
Email
øø' ,
=
øø- .
user
øø/ 3
.
øø3 4
Email
øø4 9
;
øø9 : 
existingUserClient
¿¿ &
.
¿¿& '
Password
¿¿' /
=
¿¿0 1
user
¿¿2 6
.
¿¿6 7
Password
¿¿7 ?
;
¿¿? @
context
¬¬ 
.
¬¬ 
UserClients
¬¬ '
.
¬¬' (
Update
¬¬( .
(
¬¬. / 
existingUserClient
¬¬/ A
)
¬¬A B
;
¬¬B C
await
√√ 
context
√√ !
.
√√! "
SaveChangesAsync
√√" 2
(
√√2 3
)
√√3 4
;
√√4 5
}
ƒƒ 
else
≈≈ 
if
≈≈ 
(
≈≈ 
user
≈≈ 
.
≈≈ 
UserType
≈≈ &
==
≈≈' )
UserType
≈≈* 2
.
≈≈2 3
Business
≈≈3 ;
)
≈≈; <
{
∆∆ 
var
«« "
existingUserBusiness
«« ,
=
««- .
await
««/ 4
context
««5 <
.
««< =
UserBusinesses
««= K
.
««K L
	FindAsync
««L U
(
««U V
user
««V Z
.
««Z [
UserId
««[ a
)
««a b
;
««b c
if
»» 
(
»» "
existingUserBusiness
»» ,
==
»»- /
null
»»0 4
)
»»4 5
{
…… 
return
   
Result
   %
<
  % &
object
  & ,
>
  , -
.
  - .
Failure
  . 5
(
  5 6
$str
  6 N
)
  N O
;
  O P
}
ÀÀ "
existingUserBusiness
ÕÕ (
.
ÕÕ( )
Name
ÕÕ) -
=
ÕÕ. /
user
ÕÕ0 4
.
ÕÕ4 5
Name
ÕÕ5 9
;
ÕÕ9 :"
existingUserBusiness
ŒŒ (
.
ŒŒ( )
Email
ŒŒ) .
=
ŒŒ/ 0
user
ŒŒ1 5
.
ŒŒ5 6
Email
ŒŒ6 ;
;
ŒŒ; <"
existingUserBusiness
œœ (
.
œœ( )
Password
œœ) 1
=
œœ2 3
user
œœ4 8
.
œœ8 9
Password
œœ9 A
;
œœA B
context
—— 
.
—— 
UserBusinesses
—— *
.
——* +
Update
——+ 1
(
——1 2"
existingUserBusiness
——2 F
)
——F G
;
——G H
await
““ 
context
““ !
.
““! "
SaveChangesAsync
““" 2
(
““2 3
)
““3 4
;
““4 5
}
”” 
return
‘‘ 
Result
‘‘ 
<
‘‘ 
object
‘‘ $
>
‘‘$ %
.
‘‘% &
Success
‘‘& -
(
‘‘- .
new
‘‘. 1
object
‘‘2 8
(
‘‘8 9
)
‘‘9 :
)
‘‘: ;
;
‘‘; <
}
’’ 
catch
÷÷ 
(
÷÷ 
	Exception
÷÷ 
ex
÷÷ 
)
÷÷  
{
◊◊ 
return
ÿÿ 
Result
ÿÿ 
<
ÿÿ 
object
ÿÿ $
>
ÿÿ$ %
.
ÿÿ% &
Failure
ÿÿ& -
(
ÿÿ- .
ex
ÿÿ. 0
.
ÿÿ0 1
Message
ÿÿ1 8
)
ÿÿ8 9
;
ÿÿ9 :
}
ŸŸ 
}
⁄⁄ 	
}
›› 
}ﬁﬁ ª>
HD:\BuySmart\BuySmart\Identity\Migrations\20250110202156_InitialCreate.cs
	namespace 	
Identity
 
. 

Migrations 
{ 
public		 

partial		 
class		 
InitialCreate		 &
:		' (
	Migration		) 2
{

 
	protected 
override 
void 
Up  "
(" #
MigrationBuilder# 3
migrationBuilder4 D
)D E
{ 	
migrationBuilder 
. 
CreateTable (
(( )
name 
: 
$str )
,) *
columns 
: 
table 
=> !
new" %
{ 
CodeId 
= 
table "
." #
Column# )
<) *
Guid* .
>. /
(/ 0
type0 4
:4 5
$str6 <
,< =
nullable> F
:F G
falseH M
)M N
,N O
Code 
= 
table  
.  !
Column! '
<' (
int( +
>+ ,
(, -
type- 1
:1 2
$str3 <
,< =
nullable> F
:F G
falseH M
)M N
,N O
CreationTime  
=! "
table# (
.( )
Column) /
</ 0
DateTime0 8
>8 9
(9 :
type: >
:> ?
$str@ F
,F G
nullableH P
:P Q
falseR W
,W X
defaultValueSqlY h
:h i
$strj }
)} ~
,~ 
Name 
= 
table  
.  !
Column! '
<' (
string( .
>. /
(/ 0
type0 4
:4 5
$str6 <
,< =
	maxLength> G
:G H
$numI L
,L M
nullableN V
:V W
falseX ]
)] ^
,^ _
Email 
= 
table !
.! "
Column" (
<( )
string) /
>/ 0
(0 1
type1 5
:5 6
$str7 =
,= >
	maxLength? H
:H I
$numJ M
,M N
nullableO W
:W X
falseY ^
)^ _
,_ `
Password 
= 
table $
.$ %
Column% +
<+ ,
string, 2
>2 3
(3 4
type4 8
:8 9
$str: @
,@ A
	maxLengthB K
:K L
$numM P
,P Q
nullableR Z
:Z [
false\ a
)a b
,b c
UserType 
= 
table $
.$ %
Column% +
<+ ,
int, /
>/ 0
(0 1
type1 5
:5 6
$str7 @
,@ A
nullableB J
:J K
falseL Q
)Q R
,R S
Image 
= 
table !
.! "
Column" (
<( )
byte) -
[- .
]. /
>/ 0
(0 1
type1 5
:5 6
$str7 =
,= >
nullable? G
:G H
trueI M
)M N
} 
, 
constraints 
: 
table "
=># %
{ 
table 
. 

PrimaryKey $
($ %
$str% ;
,; <
x= >
=>? A
xB C
.C D
CodeIdD J
)J K
;K L
} 
) 
; 
migrationBuilder   
.   
CreateTable   (
(  ( )
name!! 
:!! 
$str!! 
,!! 
columns"" 
:"" 
table"" 
=>"" !
new""" %
{## 
UserId$$ 
=$$ 
table$$ "
.$$" #
Column$$# )
<$$) *
Guid$$* .
>$$. /
($$/ 0
type$$0 4
:$$4 5
$str$$6 <
,$$< =
nullable$$> F
:$$F G
false$$H M
)$$M N
,$$N O
Name%% 
=%% 
table%%  
.%%  !
Column%%! '
<%%' (
string%%( .
>%%. /
(%%/ 0
type%%0 4
:%%4 5
$str%%6 <
,%%< =
	maxLength%%> G
:%%G H
$num%%I L
,%%L M
nullable%%N V
:%%V W
true%%X \
)%%\ ]
,%%] ^
Email&& 
=&& 
table&& !
.&&! "
Column&&" (
<&&( )
string&&) /
>&&/ 0
(&&0 1
type&&1 5
:&&5 6
$str&&7 =
,&&= >
	maxLength&&? H
:&&H I
$num&&J M
,&&M N
nullable&&O W
:&&W X
false&&Y ^
)&&^ _
,&&_ `
Password'' 
='' 
table'' $
.''$ %
Column''% +
<''+ ,
string'', 2
>''2 3
(''3 4
type''4 8
:''8 9
$str'': @
,''@ A
	maxLength''B K
:''K L
$num''M P
,''P Q
nullable''R Z
:''Z [
false''\ a
)''a b
,''b c
UserType(( 
=(( 
table(( $
.(($ %
Column((% +
<((+ ,
int((, /
>((/ 0
(((0 1
type((1 5
:((5 6
$str((7 @
,((@ A
nullable((B J
:((J K
false((L Q
,((Q R
defaultValue((S _
:((_ `
$num((a b
)((b c
,((c d
Image)) 
=)) 
table)) !
.))! "
Column))" (
<))( )
string))) /
>))/ 0
())0 1
type))1 5
:))5 6
$str))7 =
,))= >
	maxLength))? H
:))H I
$num))J M
,))M N
nullable))O W
:))W X
true))Y ]
)))] ^
}** 
,** 
constraints++ 
:++ 
table++ "
=>++# %
{,, 
table-- 
.-- 

PrimaryKey-- $
(--$ %
$str--% /
,--/ 0
x--1 2
=>--3 5
x--6 7
.--7 8
UserId--8 >
)--> ?
;--? @
}.. 
).. 
;.. 
migrationBuilder00 
.00 
CreateIndex00 (
(00( )
name11 
:11 
$str11 2
,112 3
table22 
:22 
$str22 *
,22* +
column33 
:33 
$str33 
,33  
unique44 
:44 
true44 
)44 
;44 
migrationBuilder66 
.66 
CreateIndex66 (
(66( )
name77 
:77 
$str77 &
,77& '
table88 
:88 
$str88 
,88 
column99 
:99 
$str99 
,99  
unique:: 
::: 
true:: 
):: 
;:: 
};; 	
	protected>> 
override>> 
void>> 
Down>>  $
(>>$ %
MigrationBuilder>>% 5
migrationBuilder>>6 F
)>>F G
{?? 	
migrationBuilder@@ 
.@@ 
	DropTable@@ &
(@@& '
nameAA 
:AA 
$strAA )
)AA) *
;AA* +
migrationBuilderCC 
.CC 
	DropTableCC &
(CC& '
nameDD 
:DD 
$strDD 
)DD 
;DD 
}EE 	
}FF 
}GG ®
4D:\BuySmart\BuySmart\Identity\DependencyInjection.cs
	namespace 	
Identity
 
{ 
public 

static 
class 
DependencyInjection +
{ 
public 
static 
IServiceCollection (
AddIdentity) 4
(4 5
this5 9
IServiceCollection: L
servicesM U
,U V
IConfigurationW e
configurationf s
)s t
{ 	
services 
. 
AddDbContext !
<! "
UsersDbContext" 0
>0 1
(1 2
options2 9
=>: <
options 
. 
	UseSqlite 
( 
configuration +
.+ ,
GetConnectionString, ?
(? @
$str@ P
)P Q
+R S
$strT c
)c d
)d e
;e f
var 
key 
= 
Encoding 
. 
ASCII $
.$ %
GetBytes% -
(- .
$str. Q
)Q R
;R S
services 
. 
AddAuthentication &
(& '
options' .
=>/ 1
{ 
options 
. %
DefaultAuthenticateScheme 1
=2 3
JwtBearerDefaults4 E
.E F 
AuthenticationSchemeF Z
;Z [
options 
. "
DefaultChallengeScheme .
=/ 0
JwtBearerDefaults1 B
.B C 
AuthenticationSchemeC W
;W X
} 
) 
. 
AddJwtBearer 
( 
options !
=>" $
{ 
options 
. %
TokenValidationParameters 1
=2 3
new4 7%
TokenValidationParameters8 Q
{ 
ValidateIssuer   "
=  # $
false  % *
,  * +
ValidateAudience!! $
=!!% &
false!!' ,
,!!, -
ValidateLifetime"" $
=""% &
true""' +
,""+ ,$
ValidateIssuerSigningKey## ,
=##- .
true##/ 3
,##3 4
IssuerSigningKey$$ $
=$$% &
new$$' * 
SymmetricSecurityKey$$+ ?
($$? @
key$$@ C
)$$C D
}%% 
;%% 
}&& 
)&& 
;&& 
services(( 
.(( 
	AddScoped(( 
<(( 
IUserAuthRepository(( 2
<((2 3
User((3 7
>((7 8
,((8 9
UserAuthRepository((: L
>((L M
(((M N
)((N O
;((O P
return** 
services** 
;** 
}++ 	
},, 
}-- 